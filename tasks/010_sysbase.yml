    - name: add user {{ ansible_user }} to groups 
      block:
        - name: System base - Verify if user exists
          become: true
          command: echo grep {{ ansible_user_id }} /etc/passwd
          register: user


        - name: System base - Validate the sudoers file before saving
          become: true
          ansible.builtin.lineinfile:
            path: /etc/sudoers
            state: present
            regexp: '^%SUDO ALL='
            line: '%SUDO ALL=(ALL) NOPASSWD: ALL'
            validate: /usr/sbin/visudo -cf %s


        - name: System base - adding existing user '{{ ansible_user }}' to group sudo
          become: true
          user:
            name: '{{ ansible_user }}'
            groups: 
              - sudo
              - uucp
              - audio
              - mail
            append: yes

        - name: System base - Install packages
          when: ansible_facts['distribution'] == 'Debian'
          become: true
          become_user: root
          ignore_errors: yes
          block:
            - name: System Base - Installing debian packages 
              become: true
              apt:
                install_recommends: no
                state: present
                name:
                  - autoconf
                  - alsa-tools
                  - alsa-utils
                  - bash-completion
                  - build-essential
                  - bluez-tools
                  - curl
                  - emacs-nox
                  - python3
                  - python3-pymysql
                  - pip
                  - sudo 
                  - vim-nox
                  - memtest86
                  - memtest86+
                  - mosquitto
                  - openvpn
                  - iw
                  - wireless-regdb
                  - wireless-tools
                  - htop
                  - net-tools 
                  - wpasupplicant
                  - git
                  - jq
                  - patch
                  - xterm
                  - wmaker
                  - rxvt
                  - vnc4server
                  - hostapd
                  - dnsmasq

            - name: System Base - sudoers no password
              become: true
              lineinfile:
                dest: /etc/sudoers
                regexp: "%sudo   ALL"
                line: "%sudo   ALL=(ALL:ALL) NOPASSWD:ALL"

            - name: System Base - intel-hda module settings 
              become: true
              copy:
                src: "conf/intel_hda.conf"
                dest: "/etc/modprobe.d"
                owner: root
                group: root
                mode: '0744'
                backup: yes
              
